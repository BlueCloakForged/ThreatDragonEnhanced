{
  "version": "1.0.0",
  "description": "Deterministic CWE/CAPEC suggestion rules based on node type, services, ports, and roles",
  "rules": [
    {
      "id": "https-entrypoint",
      "name": "HTTPS/HTTP Entry Points (Load Balancer + API Gateway)",
      "triggers": {
        "services": ["HTTPS:443", "HTTP:80"],
        "is_entrypoint": true,
        "role_keywords": ["load balancer", "api gateway", "gateway", "lb", "proxy", "nginx", "haproxy"]
      },
      "suggest_capec_queries": ["API Abuse", "Authentication Bypass", "Session Hijacking", "Brute Force", "Credential Stuffing"],
      "suggest_cwe_ids": ["CWE-306", "CWE-287", "CWE-285", "CWE-284", "CWE-352", "CWE-79", "CWE-918", "CWE-400"]
    },
    {
      "id": "web-server",
      "name": "Web Servers (HTTPS + SSH)",
      "triggers": {
        "services": ["HTTPS:443", "SSH:22"],
        "role_keywords": ["web server", "webserver", "apache", "nginx", "iis"]
      },
      "suggest_capec_queries": ["SQL Injection", "Cross-Site Scripting", "Forced Browsing", "Path Traversal"],
      "suggest_cwe_ids": ["CWE-79", "CWE-89", "CWE-22", "CWE-434", "CWE-287", "CWE-285", "CWE-522", "CWE-798"]
    },
    {
      "id": "app-server",
      "name": "App Servers (HTTP:8080 + SSH)",
      "triggers": {
        "services": ["HTTP:8080", "SSH:22"],
        "role_keywords": ["app server", "application server", "tomcat", "jboss", "nodejs", "express"]
      },
      "suggest_capec_queries": ["SQL Injection", "Command Injection", "Code Injection", "Credential Theft"],
      "suggest_cwe_ids": ["CWE-89", "CWE-78", "CWE-918", "CWE-285", "CWE-284", "CWE-200", "CWE-798", "CWE-522"]
    },
    {
      "id": "database-server",
      "name": "Database Servers (PostgreSQL/MySQL + SSH)",
      "triggers": {
        "services": ["PostgreSQL:5432", "MySQL:3306", "MSSQL:1433", "Oracle:1521", "SSH:22"],
        "role_keywords": ["database", "db", "postgres", "mysql", "mssql", "oracle", "sql server"]
      },
      "suggest_capec_queries": ["SQL Injection", "Credential Brute Force", "Data Exfiltration"],
      "suggest_cwe_ids": ["CWE-287", "CWE-284", "CWE-200", "CWE-319", "CWE-522"]
    },
    {
      "id": "redis-cache",
      "name": "Redis Cache (Redis:6379)",
      "triggers": {
        "services": ["Redis:6379"],
        "role_keywords": ["redis", "cache", "memcached", "session store"]
      },
      "suggest_capec_queries": ["Cache Poisoning", "Session Manipulation", "Unauthorized Access"],
      "suggest_cwe_ids": ["CWE-306", "CWE-284", "CWE-200"]
    },
    {
      "id": "file-storage",
      "name": "File Storage (NFS + SSH)",
      "triggers": {
        "services": ["NFS:2049", "SMB:445", "SSH:22"],
        "role_keywords": ["file storage", "nfs", "smb", "file server", "nas", "storage"]
      },
      "suggest_capec_queries": ["Unauthorized File Access", "Data Tampering", "Privilege Abuse"],
      "suggest_cwe_ids": ["CWE-276", "CWE-732", "CWE-22", "CWE-284"]
    },
    {
      "id": "payment-service",
      "name": "Payment Service (HTTPS:8443)",
      "triggers": {
        "services": ["HTTPS:8443"],
        "role_keywords": ["payment", "billing", "stripe", "paypal", "checkout", "transaction"]
      },
      "suggest_capec_queries": ["API Abuse", "Replay Attack", "Parameter Tampering", "Credential Theft"],
      "suggest_cwe_ids": ["CWE-295", "CWE-287", "CWE-285", "CWE-345", "CWE-798", "CWE-522"]
    },
    {
      "id": "ssh-generic",
      "name": "SSH Service (Generic)",
      "triggers": {
        "services": ["SSH:22"]
      },
      "suggest_capec_queries": ["Brute Force", "Password Spraying", "Credential Stuffing"],
      "suggest_cwe_ids": ["CWE-287", "CWE-522"]
    },
    {
      "id": "ldap-service",
      "name": "LDAP/Active Directory",
      "triggers": {
        "services": ["LDAP:389", "LDAPS:636"],
        "role_keywords": ["ldap", "active directory", "ad", "directory", "authentication"]
      },
      "suggest_capec_queries": ["LDAP Injection", "Credential Brute Force", "Authentication Bypass"],
      "suggest_cwe_ids": ["CWE-90", "CWE-287", "CWE-522"]
    },
    {
      "id": "ics-modbus",
      "name": "ICS/SCADA Modbus",
      "triggers": {
        "services": ["Modbus:502"],
        "role_keywords": ["ics", "scada", "plc", "modbus", "industrial", "hmi"]
      },
      "suggest_capec_queries": ["Protocol Manipulation", "Denial of Service", "Command Injection"],
      "suggest_cwe_ids": ["CWE-306", "CWE-319", "CWE-400", "CWE-284"]
    },
    {
      "id": "ics-opcua",
      "name": "ICS/SCADA OPC-UA",
      "triggers": {
        "services": ["OPC-UA:4840"],
        "role_keywords": ["opc", "opcua", "opc-ua", "industrial", "automation"]
      },
      "suggest_capec_queries": ["Protocol Manipulation", "Authentication Bypass", "Man-in-the-Middle"],
      "suggest_cwe_ids": ["CWE-287", "CWE-295", "CWE-319", "CWE-284"]
    },
    {
      "id": "attacker-node",
      "name": "Attacker/Red Team Node",
      "triggers": {
        "role_keywords": ["attacker", "red team", "adversary", "threat actor", "kali", "pentest"]
      },
      "suggest_capec_queries": ["Reconnaissance", "Exploitation", "Lateral Movement", "Privilege Escalation"],
      "suggest_cwe_ids": []
    },
    {
      "id": "external-actor",
      "name": "External Actor/User",
      "triggers": {
        "node_type": "actor",
        "role_keywords": ["external", "user", "client", "customer", "public"]
      },
      "suggest_capec_queries": ["Phishing", "Social Engineering", "Credential Theft"],
      "suggest_cwe_ids": ["CWE-287", "CWE-352"]
    }
  ],
  "limits": {
    "max_capec_suggestions": 3,
    "max_cwe_suggestions": 3
  }
}

